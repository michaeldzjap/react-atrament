!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("react")):"function"==typeof define&&define.amd?define(["react"],e):"object"==typeof exports?exports["react-atrament"]=e(require("react")):t["react-atrament"]=e(t.React)}(this,function(t){return function(t){function e(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=1)}([function(t,e){t.exports=function(t,e,n,i){function o(){function o(){s=Number(new Date),n.apply(c,h)}function a(){r=void 0}var c=this,u=Number(new Date)-s,h=arguments;i&&!r&&o(),r&&clearTimeout(r),void 0===i&&u>t?o():!0!==e&&(r=setTimeout(i?a:o,void 0===i?t-u:t))}var r,s=0;return"boolean"!=typeof e&&(i=n,n=e,e=void 0),o}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),o=function(t){return t&&t.__esModule?t:{default:t}}(i);e.default=o.default},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),c=n(3),u=i(c),h=n(4),f=i(h),l=n(9),p=n(11),d=function(t){function e(t){o(this,e);var n=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state={width:t.width,height:t.height},n._callDirtyHandler=n.handleDirty.bind(n),n._callScrollHandler=(0,p.debounce)(150,n.handleScroll.bind(n)),n}return s(e,t),a(e,[{key:"componentDidMount",value:function(){this.props.width||(this._canvas.style.width="100%"),this.props.height||(this._canvas.style.height="100%"),this.scaleCanvas(),this.props.onDirty&&"function"==typeof this.props.onDirty&&this._canvas.addEventListener("dirty",this._callDirtyHandler),this.props.width&&this.props.height||window.addEventListener("resize",this._callScrollHandler),this._sketcher=new l.Atrament(this._canvas,this._canvas.offsetWidth,this._canvas.offsetHeight)}},{key:"componentWillUnmount",value:function(){this.props.onDirty&&"function"==typeof this.props.onDirty&&this._canvas.removeEventListener("dirty",this._callDirtyHandler),this.props.width&&this.props.height||window.removeEventListener("resize",this._callScrollHandler),this._sketcher.destroy()}},{key:"handleScroll",value:function(){this.scaleCanvas()}},{key:"handleDirty",value:function(t){this.props.onDirty(t)}},{key:"scaleCanvas",value:function(){var t=Math.max(window.devicePixelRatio||1,1),e=(this.props.width||this._canvas.offsetWidth)*t,n=(this.props.height||this._canvas.offsetHeight)*t,i=void 0;this._sketcher&&(i=this._sketcher.toImage()),this._canvas.width=e,this._canvas.height=n;var o=this._canvas.getContext("2d");o.scale(t,t),this._sketcher&&this.constructor.fromDataURL(o,i,{width:e,height:n,ratio:t})}},{key:"clear",value:function(){this._sketcher.clear()}},{key:"render",value:function(){var t=this;return u.default.createElement("canvas",{ref:function(e){return t._canvas=e}})}},{key:"weight",get:function(){return this._sketcher.weight},set:function(t){this._sketcher.weight=t}},{key:"colour",get:function(){return this._sketcher.color},set:function(t){this._sketcher.color=t}},{key:"mode",get:function(){return this._sketcher.mode},set:function(t){if(!["erase","fill","draw"].includes(t))throw new Error("Invalid sketcher mode");this._sketcher.mode=t}},{key:"smoothing",get:function(){return this._sketcher.smoothing},set:function(t){this._sketcher.smoothing=!!t}},{key:"adaptiveStroke",get:function(){return this._sketcher.adaptiveStroke},set:function(t){this._sketcher.adaptiveStroke=!!t}},{key:"opacity",set:function(t){if(t<0||t>1)throw new Error("Opacity out of range [0, 1]");this._sketcher.opacity=t}},{key:"dirty",get:function(){return this._sketcher.dirty}}],[{key:"fromDataURL",value:function(t,e,n){var i=new Image,o=n.width/n.ratio,r=n.height/n.ratio;i.src=e,i.onload=function(){return t.drawImage(i,0,0,o,r)}}}]),e}(c.Component);d.displayName="react-atrament",d.propTypes={width:f.default.number,height:f.default.number,onDirty:f.default.func,onResize:f.default.func},e.default=d},function(e,n){e.exports=t},function(t,e,n){t.exports=n(5)()},function(t,e,n){"use strict";var i=n(6),o=n(7),r=n(8);t.exports=function(){function t(t,e,n,i,s,a){a!==r&&o(!1,"Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types")}function e(){return t}t.isRequired=t;var n={array:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e};return n.checkPropTypes=i,n.PropTypes=n,n}},function(t,e,n){"use strict";function i(t){return function(){return t}}var o=function(){};o.thatReturns=i,o.thatReturnsFalse=i(!1),o.thatReturnsTrue=i(!0),o.thatReturnsNull=i(null),o.thatReturnsThis=function(){return this},o.thatReturnsArgument=function(t){return t},t.exports=o},function(t,e,n){"use strict";function i(t,e,n,i,r,s,a,c){if(o(e),!t){var u;if(void 0===e)u=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var h=[n,i,r,s,a,c],f=0;u=new Error(e.replace(/%s/g,function(){return h[f++]})),u.name="Invariant Violation"}throw u.framesToPop=1,u}}var o=function(t){};t.exports=i},function(t,e,n){"use strict";t.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},function(t,e,n){"use strict";function i(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e,n,i){return new u(t,e,n,i)}var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=n(10),c=function(t){return t&&t.__esModule?t:{default:t}}(a),u=function(){function t(e,n,i,r){var s=this;if(o(this,t),!document)throw new Error("no DOM found");if(e instanceof window.Node&&"CANVAS"===e.tagName)this.canvas=e;else{if("string"!=typeof e)throw new Error("can't look for canvas based on '"+e+"'");this.canvas=document.querySelector(e)}if(!this.canvas)throw new Error("canvas not found");this.canvas.width=n||500,this.canvas.height=i||500,this.canvas.style.cursor="crosshair",this.mouse=new c.default;var a=function(t){t.preventDefault();var e=s.canvas.getBoundingClientRect(),n=t.changedTouches&&t.changedTouches[0]||t,i=n.offsetX,o=n.offsetY;void 0===i&&(i=n.clientX+document.documentElement.scrollLeft-e.left),void 0===o&&(o=n.clientY+document.documentElement.scrollTop-e.top),s.mouse.down?(s.draw(i,o),s._dirty||i===s.mouse.x&&o===s.mouse.y||(s._dirty=!0,s.fireDirty())):(s.mouse.x=i,s.mouse.y=o)},u=function(t){if(t.preventDefault(),a(t),"fill"===s._mode)return void s.fill();s.mouse.px=s.mouse.x,s.mouse.py=s.mouse.y,s.mouse.down=!0,s.context.beginPath(),s.context.moveTo(s.mouse.px,s.mouse.py)},h=function(){s.mouse.down=!1,s.context.closePath()};this.canvas.addEventListener("mousemove",a),this.canvas.addEventListener("mousedown",u),document.addEventListener("mouseup",h),this.canvas.addEventListener("touchstart",u),this.canvas.addEventListener("touchend",h),this.canvas.addEventListener("touchmove",a),this.destroy=function(){s.clear(),s.canvas.removeEventListener("mousemove",a),s.canvas.removeEventListener("mousedown",u),document.removeEventListener("mouseup",h),s.canvas.removeEventListener("touchstart",u),s.canvas.removeEventListener("touchend",h),s.canvas.removeEventListener("touchmove",a)},this.context=this.canvas.getContext("2d"),this.context.globalCompositeOperation="source-over",this.context.globalAlpha=1,this.context.strokeStyle=r||"rgba(0,0,0,1)",this.context.lineCap="round",this.context.lineJoin="round",this.context.translate(.5,.5),this._filling=!1,this._fillStack=[],this.SMOOTHING_INIT=.85,this.WEIGHT_SPREAD=10,this._smoothing=this.SMOOTHING_INIT,this._maxWeight=12,this._thickness=2,this._targetThickness=2,this._weight=2,this._mode="draw",this._adaptive=!0}return s(t,[{key:"draw",value:function(e,n){var i=this.mouse,o=this.context,r=t.lineDistance(e,n,i.px,i.py),s=Math.min(.87,this._smoothing+(r-60)/3e3);i.x=e-(e-i.px)*s,i.y=n-(n-i.py)*s;var a=t.lineDistance(i.x,i.y,i.px,i.py);this._adaptive?(this._targetThickness=(a-1)/49*(this._maxWeight-this._weight)+this._weight,this._thickness>this._targetThickness?this._thickness-=.5:this._thickness<this._targetThickness&&(this._thickness+=.5),o.lineWidth=this._thickness):o.lineWidth=this._weight,o.quadraticCurveTo(i.px,i.py,i.x,i.y),o.stroke(),i.px=i.x,i.py=i.y}},{key:"fireDirty",value:function(){var t=document.createEvent("Event");t.initEvent("dirty",!0,!0),this.canvas.dispatchEvent(t)}},{key:"clear",value:function(){this.dirty&&(this._dirty=!1,this.fireDirty(),"destination-out"===this.context.globalCompositeOperation?(this.mode="draw",this.context.clearRect(-10,-10,this.canvas.width+20,this.canvas.height+20),this.mode="erase"):this.context.clearRect(-10,-10,this.canvas.width+20,this.canvas.height+20))}},{key:"toImage",value:function(){return this.canvas.toDataURL()}},{key:"fill",value:function(){var t=this,e=this.mouse,n=this.context,i=Array.prototype.slice.call(n.getImageData(e.x,e.y,1,1).data,0);this._filling?this._fillStack.push([e.x,e.y,i]):(this.canvas.style.cursor="progress",this._filling=!0,setTimeout(function(){t._floodFill(e.x,e.y,i)},100))}},{key:"_floodFill",value:function(e,n,o){var r=this,s=this.context,a=s.canvas.width,c=s.canvas.height,u=[[e,n]],h=t.hexToRgb(this.color),f=s.getImageData(0,0,s.canvas.width,s.canvas.height),l=Math.min(10*s.globalAlpha*255,255),p=t.colorPixel.apply(t,[f.data].concat(i(h),[o,l])),d=t.matchColor.apply(t,[f.data].concat(i(o)));if(t.matchColor.apply(t,[f.data].concat([].concat(i(h),[255])))(4*(n*s.canvas.width+e)))return this._filling=!1,void setTimeout(function(){r.canvas.style.cursor="crosshair"},100);for(;u.length;){for(var y=u.pop(),v=y[0],_=y[1],m=4*(_*a+v);_-- >=0&&d(m);)m-=4*a;m+=4*a,++_;for(var g=!1,w=!1;_++<c-1&&d(m);)p(m),v>0&&(d(m-4)?g||(u.push([v-1,_]),g=!0):g&&(g=!1)),v<a-1&&(d(m+4)?w||(u.push([v+1,_]),w=!0):w&&(w=!1)),m+=4*a}s.putImageData(f,0,0),this._fillStack.length?this._floodFill.apply(this,i(this._fillStack.shift())):(this._filling=!1,setTimeout(function(){r.canvas.style.cursor="crosshair"},100))}},{key:"color",get:function(){return this.context.strokeStyle},set:function(t){if("string"!=typeof t)throw new Error("wrong argument type");this.context.strokeStyle=t}},{key:"weight",get:function(){return this._weight},set:function(t){if("number"!=typeof t)throw new Error("wrong argument type");this._weight=t,this._thickness=t,this._targetThickness=t,this._maxWeight=t+this.WEIGHT_SPREAD}},{key:"adaptiveStroke",get:function(){return this._adaptive},set:function(t){this._adaptive=!!t}},{key:"mode",get:function(){return this._mode},set:function(t){if("string"!=typeof t)throw new Error("wrong argument type");switch(t){case"erase":this._mode="erase",this.context.globalCompositeOperation="destination-out";break;case"fill":this._mode="fill",this.context.globalCompositeOperation="source-over";break;default:this._mode="draw",this.context.globalCompositeOperation="source-over"}}},{key:"dirty",get:function(){return!!this._dirty}},{key:"smoothing",get:function(){return this._smoothing===this.SMOOTHING_INIT},set:function(t){if("boolean"!=typeof t)throw new Error("wrong argument type");this._smoothing=t?this.SMOOTHING_INIT:0}},{key:"opacity",set:function(t){if("number"!=typeof t)throw new Error("wrong argument type");this.context.globalAlpha=t>=1?1:t/10}}],[{key:"lineDistance",value:function(t,e,n,i){var o=Math.pow(n-t,2),r=Math.pow(i-e,2);return Math.sqrt(o+r)}},{key:"hexToRgb",value:function(t){var e=t.match(/^#?([\da-f]{2})([\da-f]{2})([\da-f]{2})$/i);return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{key:"matchColor",value:function(t,e,n,i,o){return function(r){var s=t[r],a=t[r+1],c=t[r+2],u=t[r+3];return s===e&&a===n&&c===i&&u===o}}},{key:"colorPixel",value:function(e,n,o,r,s,a){var c=t.matchColor.apply(t,[e].concat(i(s)));return function(t){e[t]=n,e[t+1]=o,e[t+2]=r,e[t+3]=a,c(t+4)||(e[t+4]=.01*e[t+4]+.99*n,e[t+4+1]=.01*e[t+4+1]+.99*o,e[t+4+2]=.01*e[t+4+2]+.99*r,e[t+4+3]=.01*e[t+4+3]+.99*a),c(t-4)||(e[t-4]=.01*e[t-4]+.99*n,e[t-4+1]=.01*e[t-4+1]+.99*o,e[t-4+2]=.01*e[t-4+2]+.99*r,e[t-4+3]=.01*e[t-4+3]+.99*a)}}}]),t}();t.exports=r,t.exports.Atrament=u},function(t,e,n){"use strict";function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=function(){function t(e,n){r(this,t),this._x=e,this._y=n}return s(t,[{key:"set",value:function(t,e){this._x=t,this._y=e}},{key:"x",get:function(){return this._x},set:function(t){this._x=t}},{key:"y",get:function(){return this._y},set:function(t){this._y=t}}]),t}(),c=function(t){function e(){r(this,e);var t=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,0,0));return t._down=!1,t._px=0,t._py=0,t}return o(e,t),s(e,[{key:"down",get:function(){return this._down},set:function(t){this._down=t}},{key:"x",get:function(){return this._x},set:function(t){this._x=t}},{key:"y",get:function(){return this._y},set:function(t){this._y=t}},{key:"px",get:function(){return this._px},set:function(t){this._px=t}},{key:"py",get:function(){return this._py},set:function(t){this._py=t}}]),e}(a);e.default=c},function(t,e,n){var i=n(0),o=n(12);t.exports={throttle:i,debounce:o}},function(t,e,n){var i=n(0);t.exports=function(t,e,n){return void 0===n?i(t,e,!1):i(t,n,!1!==e)}}])});